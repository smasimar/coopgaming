<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Co-op Gaming Tracker</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #333;
        color: #fff;
    }
    table {
        margin: 0 auto; /* Center the table */
        width: auto; /* Adjust the width as needed */
        border-collapse: collapse;
        border: 1px solid #555;
    }
    th, td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #555;
    }
    th {
        background-color: #555;
    }
    tr:hover {
        background-color: #444;
    }
    img {
        max-width: 100px;
        max-height: 100px;
    }
</style>
</head>
<body>
<table id="content"></table>

<script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('data.csv')
    /*  CSV should look like this:
        GameID,p1Owned,p2Owned
        221040,true,true
        21690,true,true
        1065310,true,false  */
    .then(response => response.text())
    .then(csvData => {
        var parsedData = parseCSV(csvData);
        generateContent(parsedData);
    })
    .catch(error => console.error('Error fetching the CSV file:', error));

    // URLs to images for player ownership
    var ImgCheck = "check.png";
    var ImgCross = "cross.png";

    // Parse CSV data
    function parseCSV(csv) {
        var lines = csv.split('\n');
        var result = [];
        var headers = lines[0].split(',');
        for (var i = 1; i < lines.length; i++) {
            var obj = {};
            var currentline = lines[i].split(',');
            for (var j = 0; j < headers.length; j++) {
                obj[headers[j].trim()] = currentline[j].trim();
            }
            result.push(obj);
        }
        return result;
    }

    // Generate HTML content
    function generateContent(data) {
        var content = document.getElementById('content');
        content.innerHTML = ''; // Clear previous content

        // Create table header
        var tableHTML = "<tr><th>Game ID</th><th>Masimar</th><th>McCree</th></tr>";

        // Iterate over data to create table rows
        data.forEach(function(item) {
            var p1Owned = `<img src="${item.p1Owned === 'true' ? ImgCheck : ImgCross}" alt="${item.p1Owned}">`;
            var p2Owned = `<img src="${item.p2Owned === 'true' ? ImgCheck : ImgCross}" alt="${item.p2Owned}">`;
            var rowHTML = `<tr><td><iframe id="iframe-${item.GameID}" src="https://store.steampowered.com/widget/${item.GameID}/" frameborder="0" width="646" height="190"></iframe></td><td>${p1Owned}</td><td>${p2Owned}</td></tr>`;
            tableHTML += rowHTML;
        });

        // Append table to content
        content.innerHTML = '<table border="1">' + tableHTML + '</table>';

        // Identify iframes and extract prices
        data.forEach(function(item) {
            var iframe = document.getElementById(`iframe-${item.GameID}`);
            if (iframe) {
                iframe.onload = function() {
                    var iframeContent = this.contentWindow.document;
                    var priceElement = iframeContent.querySelector('.discount_final_price, .game_purchace_price.price');
                    if (priceElement) {
                        var price = priceElement.textContent.trim();
                        this.title = 'Price: ' + price;
                    }
                };
            }
        });
    }
});
</script>
</body>
</html>
